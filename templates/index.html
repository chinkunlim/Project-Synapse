<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Synapse Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card {
            border-radius: 12px;
            border: none;
        }

        .card-header {
            border-radius: 12px 12px 0 0 !important;
            font-weight: bold;
        }

        .btn {
            border-radius: 8px;
        }

        .status-badge {
            font-size: 0.9em;
            padding: 6px 12px;
            border-radius: 20px;
        }
    </style>
</head>

<body class="bg-light">
    <div class="container py-5">
        <header class="text-center mb-5">
            <h1 class="display-4 fw-bold text-primary">ğŸ§  Project Synapse</h1>
            <p class="lead text-muted">AI åŠ©æ•™ç¥ç¶“ä¸­æ¨ (Classroom + Notion + PDF Engine)</p>
        </header>

        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white py-3">
                <h5 class="mb-0 text-primary">ğŸ“‹ å¾…è¾¦ä»»å‹™åˆ—è¡¨ (From Notion)</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">ä»»å‹™åç¨±</th>
                                <th scope="col">æˆªæ­¢æ—¥æœŸ</th>
                                <th scope="col">ç‹€æ…‹</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for task in tasks %}
                            <tr>
                                <td class="fw-bold">{{ task.task }}</td>
                                <td>{{ task.deadline }}</td>
                                <td>
                                    <span
                                        class="badge status-badge bg-{{ 'success' if task.status == 'Done' else 'warning' }}">
                                        {{ task.status }}
                                    </span>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="3" class="text-center text-muted py-4">ç›®å‰æ²’æœ‰ä»»å‹™ï¼Œæˆ–ç„¡æ³•é€£ç·šè‡³ Notionã€‚</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm border-success h-100">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">ğŸ‘¨â€ğŸ« æ•™å¸«æ¨¡å¼ (Educator)</h5>
                    </div>
                    <div class="card-body text-center d-flex flex-column justify-content-center">
                        <p class="card-text text-muted mb-4">
                            åŒæ­¥ Google Classroom æˆç¸¾è‡³ Notion è³‡æ–™åº«ï¼Œä¸¦è‡ªå‹•ç™¼é€ç¼ºäº¤æé†’ã€‚
                        </p>
                        <form action="/trigger-n8n" method="POST" target="_blank">
                            <button type="submit" class="btn btn-outline-success w-100 py-2">
                                ğŸš€ è§¸ç™¼ N8N è‡ªå‹•åŒ–æµç¨‹
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-md-4 text-end">
                <a href="/notion" class="btn btn-outline-dark btn-lg w-100 py-3">
                    âš™ï¸ Notion ç³»çµ±ç®¡ç†
                </a>
            </div>
            <div class="card shadow-sm border-danger mb-4">
                <div class="col-12 mb-4">
                    <div class="card shadow-sm border-danger">
                        <div class="card-header bg-danger text-white">âš™ï¸ ç³»çµ±åˆå§‹åŒ–èˆ‡é…ç½®</div>
                        <div class="card-body">
                            <p class="text-muted">ç¬¬ä¸€æ¬¡ä½¿ç”¨æˆ–éœ€è¦é‡å»º Notion ç’°å¢ƒæ™‚ï¼Œè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•ã€‚é€™å°‡æœƒè®€å–
                                <code>config/notion_schema.json</code> ä¸¦è‡ªå‹•å»ºç«‹è³‡æ–™åº«ã€‚</p>
                            <button onclick="initNotion()" class="btn btn-danger" id="initBtn">ğŸš€ ä¸€éµåˆå§‹åŒ– Notion
                                ç’°å¢ƒ</button>
                            <div id="setup-status" class="mt-2 fw-bold"></div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 mb-4">
                    <div class="card shadow-sm border-primary h-100">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">ğŸ‘¨â€ğŸ“ å­¸ç”Ÿå°ˆå€ (Student)</h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small mb-3">é¸æ“‡ä»»å‹™ä¸¦ä¸Šå‚³æ‚¨çš„ä½œæ¥­æª”æ¡ˆè‡³ç³»çµ±ã€‚</p>

                            <form action="/student/submit" method="POST" enctype="multipart/form-data">

                                <div class="mb-3">
                                    <label class="form-label">æ‚¨çš„å§“å</label>
                                    <input type="text" name="student_name" class="form-control" placeholder="è«‹è¼¸å…¥å§“å"
                                        required>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">é¸æ“‡ä»»å‹™</label>
                                    <select name="task_name" class="form-select" required>
                                        <option value="" disabled selected>-- è«‹é¸æ“‡è¦ç¹³äº¤çš„ä½œæ¥­ --</option>
                                        {% for task in tasks %}
                                        {% if task.status != 'Done' %}
                                        <option value="{{ task.task }}">{{ task.task }} (æˆªæ­¢: {{ task.deadline }})
                                        </option>
                                        {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">ä½œæ¥­æª”æ¡ˆ</label>
                                    <input type="file" name="homework_file" class="form-control" required>
                                </div>

                                <button type="submit" class="btn btn-primary w-100">
                                    ğŸ“¤ æäº¤ä½œæ¥­ (Upload)
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12 mb-4">
                    <div class="card shadow-sm border-dark">
                        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">ğŸ› ï¸ å­¸è¡“ç”Ÿç”¢åŠ›å·¥å…· (Academic Tools)</h5>
                        </div>
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h5 class="card-title fw-bold">ğŸ“„ è«–æ–‡ç·¨è­¯å·¥å»  (PDF Factory)</h5>
                                    <p class="card-text text-muted mb-0">
                                        å°ˆç‚ºå­¸è¡“å¯«ä½œè¨­è¨ˆã€‚ä¸Šå‚³ Markdown æª”æ¡ˆèˆ‡åœ–ç‰‡ï¼Œç³»çµ±å°‡è‡ªå‹•æ’ç‰ˆä¸¦ç”Ÿæˆç¬¦åˆ
                                        <strong>ä¸­è¯å¿ƒç†å­¸åˆŠ (CJP)</strong> æˆ– <strong>APA 7th</strong> æ ¼å¼çš„ PDF è«–æ–‡ã€‚
                                        <br><small class="text-secondary">* æ”¯æ´ LaTeX æ•¸å­¸å…¬å¼ã€è‡ªå‹•åœ–è¡¨ç·¨è™Ÿèˆ‡æ–‡ç»å¼•ç”¨ã€‚</small>
                                    </p>
                                </div>
                                <div class="col-md-4 text-end mt-3 mt-md-0">
                                    <a href="/thesis" class="btn btn-dark btn-lg w-100 py-3">
                                        ğŸš€ é€²å…¥ç·¨è­¯å·¥å» 
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <footer class="text-center text-muted py-4 small">
            &copy; 2025 Project Synapse. Powered by Flask, Notion API, Docker & N8N.
        </footer>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

<script>
    function initNotion() {
        if (!confirm("é€™å°‡æœƒåœ¨æ‚¨çš„ Notion é é¢å»ºç«‹æ–°è³‡æ–™åº«ï¼Œç¢ºå®šå—ï¼Ÿ")) return;

        const btn = document.getElementById('initBtn');
        const status = document.getElementById('setup-status');

        btn.disabled = true;
        status.className = "mt-2 text-primary";
        status.innerText = "â³ æ­£åœ¨åŸ·è¡Œåˆå§‹åŒ–ï¼Œé€™å¯èƒ½éœ€è¦ä¸€åˆ†é˜ï¼Œè«‹å‹¿é—œé–‰ç¶²é ...";

        fetch('/api/notion/setup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    status.className = "mt-2 text-success";
                    status.innerText = "âœ… " + data.message;
                    alert(data.message + " é é¢å³å°‡é‡æ–°æ•´ç†ã€‚");
                    location.reload();
                } else {
                    throw new Error(data.message);
                }
            })
            .catch(error => {
                status.className = "mt-2 text-danger";
                status.innerText = "âŒ å¤±æ•—: " + error.message;
                btn.disabled = false;
            });
    }
</script>

</html>